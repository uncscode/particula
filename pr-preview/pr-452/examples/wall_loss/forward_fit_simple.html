
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Simple Wall Loss Fit &#8212; Particula Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/wall_loss/forward_fit_simple';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lagrangian Particle Model" href="../lagrangian/lagrangian_intro.html" />
    <link rel="prev" title="Chamber Forward Simulation" href="wall_loss_forward_simulation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/placeholder.png" class="logo__image only-light" alt="Particula Book - Home"/>
    <script>document.write(`<img src="../../_static/placeholder.png" class="logo__image only-dark" alt="Particula Book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Getting started
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Tour</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../tour/part-tour.html">Particula tour</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../distribution_statistics.html">Distribution statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distribution_coagulation.html">Distribution coagulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distribution_evolution.html">Distribution evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distribution_ambient.html">Distributions</a></li>

<li class="toctree-l1"><a class="reference internal" href="../ionparticle_coagulation.html">Ionâ€“particle coagulation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../streamlake/particula_data.html">Data in Particula</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../streamlake/loading_data_part1.html">Loading Part 1: Into &amp; 1D Data</a></li>



<li class="toctree-l2"><a class="reference internal" href="../streamlake/loading_data_part2.html">Loading Part 2: Sizer Data</a></li>

<li class="toctree-l2"><a class="reference internal" href="../streamlake/loading_data_part3.html">Loading Part 3: Lake</a></li>



<li class="toctree-l2"><a class="reference internal" href="../streamlake/loading_data_part4.html">Loading Part 4: Settings Files</a></li>

<li class="toctree-l2"><a class="reference internal" href="../streamlake/stream_stats_part1.html">Stream: Averaging and Outliers</a></li>



<li class="toctree-l2"><a class="reference internal" href="../streamlake/stream_stats_size_distribution_part2.html">Size Distribution Stats</a></li>



</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../wall_loss_section.html">Chamber Wall Loss Analysis</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="chamber_smps_data.html">Chamber Analysis</a></li>

<li class="toctree-l2"><a class="reference internal" href="wall_loss_forward_simulation.html">Chamber Forward Simulation</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Simple Wall Loss Fit</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../lagrangian/lagrangian_intro.html">Lagrangian Particle Model</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../lagrangian/basic_lagrangian_box.html">Introduction to the Lagrangian Box Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lagrangian/sweep_and_prune.html">Sweep and Prune Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lagrangian/friction_force.html">Realistic Drag, Mass, and Velocity</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../equilibria/equilibria_intro.html">Equilibria of Aerosols</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../equilibria/activity_part1.html">Activity Example</a></li>

<li class="toctree-l2"><a class="reference internal" href="../equilibria/equilibria_part1.html">Liquid Vapor Equilibrium</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../light_scattering/aerosol_optics_intro.html">Introduction to Aerosol Optics</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../light_scattering/mie_basics.html">Mie Scattering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../light_scattering/humid_scattering.html">Scattering for Humidified Particles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../light_scattering/kappa_vs_extinction.html">Fitting Kappa-HGF from Light Extinction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../light_scattering/scattering_truncation.html">Scattering Truncation Corrections</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../documentation/environment.html">The <code class="docutils literal notranslate"><span class="pre">Environment</span></code> Class</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/dilution_loss.html"><code class="docutils literal notranslate"><span class="pre">dilution_loss</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/dynamic_viscosity.html"><code class="docutils literal notranslate"><span class="pre">dynamic_viscosity</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/mean_free_path.html"><code class="docutils literal notranslate"><span class="pre">mean_free_path</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/vapor.html">The <code class="docutils literal notranslate"><span class="pre">Vapor</span></code> Class</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../documentation/particle.html">The <code class="docutils literal notranslate"><span class="pre">Particle</span></code> Classes</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/distribution_discretization.html"><code class="docutils literal notranslate"><span class="pre">distribution_discretization</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/radius_cutoff.html"><code class="docutils literal notranslate"><span class="pre">radius_cutoff</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/particle_mass.html"><code class="docutils literal notranslate"><span class="pre">particle_mass</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/knudsen_number.html"><code class="docutils literal notranslate"><span class="pre">knudsen_number</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/slip_correction.html"><code class="docutils literal notranslate"><span class="pre">slip_correction</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/friction_factor.html"><code class="docutils literal notranslate"><span class="pre">friction_factor</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/dimensionless_coagulation.html"><code class="docutils literal notranslate"><span class="pre">dimensionless_coagulation</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../documentation/utilities/utilities_overview.html">Utilities Functions</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/convert_size_dist_scales.html">Converting Distributions</a></li>


</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Strategic Plan</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../strategic_plan/strategic_planning_FY24.html">FY24 Plan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../strategic_plan/Aerosol_patterns.html">Program Outline Revision Draft</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Prototype</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../documentation/base/base_overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/base/gas.html">Gases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/base/base_particle.html">Strategies in Particle Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/base/base_aerosol.html">Aerosol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/base/base_runnable_process.html">Modeling Aerosol Dynamics with Runnable Processes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../CONTRIBUTING.html">Contributor Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CODE_OF_CONDUCT.html">Code of Conduct</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/uncscode/particula/v0.0.10?urlpath=lab/tree/docs/examples/wall_loss/forward_fit_simple.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/uncscode/particula/blob/v0.0.10/docs/examples/wall_loss/forward_fit_simple.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/uncscode/particula" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/uncscode/particula/edit/v0.0.10/docs/examples/wall_loss/forward_fit_simple.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/uncscode/particula/issues/new?title=Issue%20on%20page%20%2Fexamples/wall_loss/forward_fit_simple.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/examples/wall_loss/forward_fit_simple.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Simple Wall Loss Fit</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#approach">Approach:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation-loading-and-converting-smps-data">Data Preparation: Loading and Converting SMPS Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation-time-window-selection-and-data-cleaning">Data Preparation: Time Window Selection and Data Cleaning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-of-processed-data">Visualization of Processed Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-simulation-properties-chamber-flow-rates-and-dilution-correction">Setting Simulation Properties: Chamber Flow Rates and Dilution Correction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-simulation-functions">Defining Simulation Functions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">Functions:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#performing-chamber-simulation-and-optimization">Performing Chamber Simulation and Optimization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-input-parameters">Setting Input Parameters:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optimizing-ktp-value">Optimizing ktp Value:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-final-simulation">Running Final Simulation:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-of-simulation-results">Visualization of Simulation Results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-the-notebook">Summary of the Notebook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#achievements">Achievements:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps:</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="simple-wall-loss-fit">
<h1>Simple Wall Loss Fit<a class="headerlink" href="#simple-wall-loss-fit" title="Link to this heading">#</a></h1>
<p>In this section, we integrate particle simulations with data import tools to optimize wall-loss parameters in a chamber environment. This process is essential in understanding and accurately modeling the behavior of aerosol particles within a confined space.</p>
<section id="approach">
<h2>Approach:<a class="headerlink" href="#approach" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>We commence by defining the initial size distribution of particles at the start time (<code class="docutils literal notranslate"><span class="pre">t_start</span></code>).</p></li>
<li><p>Utilizing <code class="docutils literal notranslate"><span class="pre">particula.Solver</span></code>, we simulate the dynamics of particles in the chamber up to a specified end time (<code class="docutils literal notranslate"><span class="pre">t_end</span></code>).</p></li>
<li><p>An optimization routine is then employed, which iteratively adjusts the wall eddy diffusivity parameter. The objective is to align the simulated particle size distribution as closely as possible with the observed (measured) distribution.</p></li>
</ul>
<p><strong>Note</strong>: This method, while conceptually straightforward, may not be the most computationally efficient. However, it provides clear insights into the fitting process of wall-loss parameters in aerosol simulations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Forward Wall Loss Simulation</span>

<span class="c1"># Import necessary libraries</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span><span class="p">,</span> <span class="n">Bounds</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span> <span class="nn">particula</span> <span class="kn">import</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">particula.data</span> <span class="kn">import</span> <span class="n">loader_interface</span><span class="p">,</span> <span class="n">settings_generator</span>
<span class="kn">from</span> <span class="nn">particula.data.tests.example_data.get_example_data</span> <span class="kn">import</span> <span class="n">get_data_folder</span>

<span class="kn">from</span> <span class="nn">particula.data</span> <span class="kn">import</span> <span class="n">stream_stats</span>
<span class="kn">from</span> <span class="nn">particula.util</span> <span class="kn">import</span> <span class="n">convert</span><span class="p">,</span> <span class="n">time_manage</span>

<span class="kn">from</span> <span class="nn">particula.dynamics</span> <span class="kn">import</span> <span class="n">Solver</span>
<span class="kn">from</span> <span class="nn">particula</span> <span class="kn">import</span> <span class="n">particle</span>

<span class="kn">from</span> <span class="nn">particula.util.convert</span> <span class="kn">import</span> <span class="n">distribution_convert_pdf_pms</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-preparation-loading-and-converting-smps-data">
<h2>Data Preparation: Loading and Converting SMPS Data<a class="headerlink" href="#data-preparation-loading-and-converting-smps-data" title="Link to this heading">#</a></h2>
<p>In this section, we focus on preparing the data necessary for our particle simulation and optimization process. This involves setting the data directory, loading the data, and performing initial conversions.</p>
<p><strong>Steps:</strong></p>
<ul class="simple">
<li><p>Set Data Directory: We define the path to our data directory. This directory contains all the necessary data files for the simulation.</p></li>
<li><p>Load 1D Data: We load the 1-dimensional (1D) data, which represents specific characteristics of particles measured by the Scanning Mobility Particle Sizer (SMPS).</p></li>
<li><p>Load 2D Data: Similar to step 2, we load the 2-dimensional (2D) data. This data provides a more comprehensive representation of particle characteristics.</p></li>
<li><p>Data Conversion: The loaded 2D data is initially in the form of dn/dlogDp. We convert this to a suitable format for further analysis.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the parent directory of the data folders</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">get_data_folder</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Path to data folder:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;particula&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Load the 2D data</span>
<span class="n">smps_2d_stream_settings</span> <span class="o">=</span> <span class="n">settings_generator</span><span class="o">.</span><span class="n">load_settings_for_stream</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
    <span class="n">subfolder</span><span class="o">=</span><span class="s1">&#39;chamber_data&#39;</span><span class="p">,</span>
    <span class="n">settings_suffix</span><span class="o">=</span><span class="s1">&#39;_smps_2d&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">stream_smps_2d</span> <span class="o">=</span> <span class="n">loader_interface</span><span class="o">.</span><span class="n">load_files_interface</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
    <span class="n">settings</span><span class="o">=</span><span class="n">smps_2d_stream_settings</span>
<span class="p">)</span>

<span class="c1"># Convert from dn/dlogDp</span>
<span class="n">stream_smps_2d</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">convert</span><span class="o">.</span><span class="n">convert_sizer_dn</span><span class="p">(</span>
    <span class="n">diameter</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stream_smps_2d</span><span class="o">.</span><span class="n">header</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span>
    <span class="n">dn_dlogdp</span><span class="o">=</span><span class="n">stream_smps_2d</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Path to data folder:
/data/tests/example_data
  Loading file: 2023-09-25_160155_SMPS.csv
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-preparation-time-window-selection-and-data-cleaning">
<h2>Data Preparation: Time Window Selection and Data Cleaning<a class="headerlink" href="#data-preparation-time-window-selection-and-data-cleaning" title="Link to this heading">#</a></h2>
<p>In this section, we focus on refining our dataset by selecting specific time windows and cleaning the data. This step is crucial to ensure the accuracy and relevance of our particle simulation and optimization.</p>
<p><strong>Steps</strong>:</p>
<ul class="simple">
<li><p>Select Time Window: We define a specific time window that is considered â€˜badâ€™ or irrelevant for our analysis. This window is defined by a start and an end epoch time.</p></li>
<li><p>Remove Bad Data: Data within this â€˜badâ€™ time window is removed from our dataset to improve the quality of our analysis.</p></li>
<li><p>Crop Data Start and End: We further refine our dataset by cropping the data at the start and end of our experiment. This is done by defining start and end epoch times for the experiment and removing data outside this range.</p></li>
<li><p>Data Averaging: Finally, we average the data into 15-minute intervals. This step simplifies the dataset and makes it more manageable for analysis.
python</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select the time window</span>
<span class="n">bad_window_start_epoch</span> <span class="o">=</span> <span class="n">time_manage</span><span class="o">.</span><span class="n">time_str_to_epoch</span><span class="p">(</span>
    <span class="n">time</span><span class="o">=</span><span class="s1">&#39;09-25-2023 19:00:00&#39;</span><span class="p">,</span>
    <span class="n">time_format</span><span class="o">=</span><span class="s1">&#39;%m-</span><span class="si">%d</span><span class="s1">-%Y %H:%M:%S&#39;</span><span class="p">,</span>
    <span class="n">timezone_identifier</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span>
<span class="p">)</span>
<span class="n">bad_window_end_epoch</span> <span class="o">=</span> <span class="n">time_manage</span><span class="o">.</span><span class="n">time_str_to_epoch</span><span class="p">(</span>
    <span class="n">time</span><span class="o">=</span><span class="s1">&#39;09-25-2023 19:45:00&#39;</span><span class="p">,</span>
    <span class="n">time_format</span><span class="o">=</span><span class="s1">&#39;%m-</span><span class="si">%d</span><span class="s1">-%Y %H:%M:%S&#39;</span><span class="p">,</span>
    <span class="n">timezone_identifier</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Length of stream before crop: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stream_smps_2d</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># Remove the bad data</span>
<span class="n">stream_smps_2d</span> <span class="o">=</span> <span class="n">stream_stats</span><span class="o">.</span><span class="n">remove_time_window</span><span class="p">(</span>
    <span class="n">stream</span><span class="o">=</span><span class="n">stream_smps_2d</span><span class="p">,</span>
    <span class="n">epoch_start</span><span class="o">=</span><span class="n">bad_window_start_epoch</span><span class="p">,</span>
    <span class="n">epoch_end</span><span class="o">=</span><span class="n">bad_window_end_epoch</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Crop start</span>
<span class="n">experiment_start_epoch</span> <span class="o">=</span> <span class="n">time_manage</span><span class="o">.</span><span class="n">time_str_to_epoch</span><span class="p">(</span>
    <span class="n">time</span><span class="o">=</span><span class="s1">&#39;09-25-2023 15:25:00&#39;</span><span class="p">,</span>
    <span class="n">time_format</span><span class="o">=</span><span class="s1">&#39;%m-</span><span class="si">%d</span><span class="s1">-%Y %H:%M:%S&#39;</span><span class="p">,</span>
    <span class="n">timezone_identifier</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span>
<span class="p">)</span>
<span class="n">stream_smps_2d</span> <span class="o">=</span> <span class="n">stream_stats</span><span class="o">.</span><span class="n">remove_time_window</span><span class="p">(</span>
    <span class="n">stream</span><span class="o">=</span><span class="n">stream_smps_2d</span><span class="p">,</span>
    <span class="n">epoch_start</span><span class="o">=</span><span class="n">stream_smps_2d</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">epoch_end</span><span class="o">=</span><span class="n">experiment_start_epoch</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Crop the end</span>
<span class="n">experiment_end_epoch</span> <span class="o">=</span> <span class="n">time_manage</span><span class="o">.</span><span class="n">time_str_to_epoch</span><span class="p">(</span>
    <span class="n">time</span><span class="o">=</span><span class="s1">&#39;09-26-2023 07:00:00&#39;</span><span class="p">,</span>
    <span class="n">time_format</span><span class="o">=</span><span class="s1">&#39;%m-</span><span class="si">%d</span><span class="s1">-%Y %H:%M:%S&#39;</span><span class="p">,</span>
    <span class="n">timezone_identifier</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span>
<span class="p">)</span>
<span class="n">stream_smps_2d</span> <span class="o">=</span> <span class="n">stream_stats</span><span class="o">.</span><span class="n">remove_time_window</span><span class="p">(</span>
    <span class="n">stream</span><span class="o">=</span><span class="n">stream_smps_2d</span><span class="p">,</span>
    <span class="n">epoch_start</span><span class="o">=</span><span class="n">experiment_end_epoch</span><span class="p">,</span>
    <span class="n">epoch_end</span><span class="o">=</span><span class="n">stream_smps_2d</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1"># Average to 15 minute intervals</span>
<span class="n">average_interval</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">15</span>  <span class="c1"># seconds</span>
<span class="n">stream_averaged_2d</span> <span class="o">=</span> <span class="n">stream_stats</span><span class="o">.</span><span class="n">average_std</span><span class="p">(</span>
    <span class="n">stream</span><span class="o">=</span><span class="n">stream_smps_2d</span><span class="p">,</span>
    <span class="n">average_interval</span><span class="o">=</span><span class="n">average_interval</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># get the time in hours</span>
<span class="n">experiment_time</span> <span class="o">=</span> <span class="n">time_manage</span><span class="o">.</span><span class="n">relative_time</span><span class="p">(</span>
    <span class="n">epoch_array</span><span class="o">=</span><span class="n">stream_averaged_2d</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
    <span class="n">units</span><span class="o">=</span><span class="s1">&#39;hours&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Length of stream before crop: 336
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualization-of-processed-data">
<h2>Visualization of Processed Data<a class="headerlink" href="#visualization-of-processed-data" title="Link to this heading">#</a></h2>
<p>After refining our dataset, the next step is to visualize the data. This allows us to observe trends and patterns in the particle concentration over time, which is crucial for understanding the behavior of aerosols in the chamber. We expect to see decrease particle concentrations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the 1d data</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">experiment_time</span><span class="p">,</span>
    <span class="n">stream_averaged_2d</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">100</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Concentration&#39;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Experiment time (hours)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Particle concentration (#/cc)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/671dcaaeb4f88511f6926a4c0327ce44dce79ed45152f0770be3baa26c5dae56.png" src="../../_images/671dcaaeb4f88511f6926a4c0327ce44dce79ed45152f0770be3baa26c5dae56.png" />
</div>
</div>
</section>
<section id="setting-simulation-properties-chamber-flow-rates-and-dilution-correction">
<h2>Setting Simulation Properties: Chamber Flow Rates and Dilution Correction<a class="headerlink" href="#setting-simulation-properties-chamber-flow-rates-and-dilution-correction" title="Link to this heading">#</a></h2>
<p>In this section, we define and apply key simulation properties related to the chamber flow rates and dilution correction. This is an important step to ensure that the simulation accurately represents the physical conditions of the experiment.</p>
<p><strong>Steps</strong>:</p>
<ul class="simple">
<li><p>Define Chamber Flow Rates: We set the flow rates for both pushing air into the chamber and dilution.</p></li>
<li><p>Dilution Correction: A dilution correction factor is calculated to account for the combined effect of push and dilution flow rates.</p></li>
<li><p>Concentration Scaling: The particle concentration data is scaled to account for the dilution correction. This step adjusts the concentration values to reflect the true particle concentration inside the chamber.</p></li>
<li><p>Radius and Volume Adjustments: The particle size data (originally in diameter) is converted to radius and adjusted to meters. The concentration data is also converted to number per cubic meter.</p></li>
<li><p>Rate Constants: We calculate the rate constants for the chamber in terms of minutes and hours. These constants are crucial for understanding the dynamics of particle behavior within the chamber.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Chamber flow rates</span>
<span class="n">chamber_push</span> <span class="o">=</span> <span class="mf">1.27</span>  <span class="c1"># L/min</span>
<span class="n">chamber_dillution</span> <span class="o">=</span> <span class="mf">1.27</span>  <span class="c1"># L/min</span>

<span class="c1"># Dilution correction</span>
<span class="n">dilution_correction</span> <span class="o">=</span> <span class="p">(</span><span class="n">chamber_push</span> <span class="o">+</span> <span class="n">chamber_dillution</span><span class="p">)</span> <span class="o">/</span> <span class="n">chamber_push</span>
<span class="c1"># Scale the concentrations for dilution</span>
<span class="n">stream_smps_2d</span><span class="o">.</span><span class="n">data</span> <span class="o">*=</span> <span class="n">dilution_correction</span>

<span class="c1"># Convert diameter to radius in meters and adjust concentration units</span>
<span class="n">radius_bins</span> <span class="o">=</span> <span class="n">stream_smps_2d</span><span class="o">.</span><span class="n">header_float</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">1e-9</span>  <span class="c1"># convert to m and radius</span>
<span class="n">stream_smps_2d</span><span class="o">.</span><span class="n">data</span> <span class="o">*=</span> <span class="mf">1e6</span>  <span class="c1"># convert to number per m3</span>

<span class="c1"># Chamber volume and rate constants</span>
<span class="n">CHAMBER_VOLUME</span> <span class="o">=</span> <span class="mf">908.2</span>  <span class="c1"># L</span>
<span class="n">k_rate_chamber_min</span> <span class="o">=</span> <span class="n">chamber_push</span> <span class="o">/</span> <span class="n">CHAMBER_VOLUME</span>
<span class="n">k_rate_chamber_hr</span> <span class="o">=</span> <span class="n">k_rate_chamber_min</span> <span class="o">*</span> <span class="mi">60</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="defining-simulation-functions">
<h2>Defining Simulation Functions<a class="headerlink" href="#defining-simulation-functions" title="Link to this heading">#</a></h2>
<p>To simulate and optimize the chamber conditions for aerosol particles, we define several key functions. Each function plays a specific role in simulating the chamber environment, calculating error metrics, and optimizing parameters.</p>
<section id="functions">
<h3>Functions:<a class="headerlink" href="#functions" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong>simulate_chamber_interval</strong>:</p>
<ul class="simple">
<li><p><strong>Purpose</strong>: Simulates aerosol particle dynamics in a chamber over a specified time interval, considering various processes like coagulation, condensation, and wall loss.</p></li>
<li><p><strong>Inputs</strong>: Particle properties, time array, concentration, and radius bins.</p></li>
<li><p><strong>Outputs</strong>: Particle number density distribution and concentration distribution over time.</p></li>
</ul>
</li>
<li><p><strong>simulation_error</strong>:</p>
<ul class="simple">
<li><p><strong>Purpose</strong>: Calculates the Mean Absolute Error (MAE) between the simulated and observed particle distributions.</p></li>
<li><p><strong>Inputs</strong>: Simulated and observed particle distributions.</p></li>
<li><p><strong>Outputs</strong>: MAE value, quantifying the accuracy of the simulation.</p></li>
</ul>
</li>
<li><p><strong>chamber_ktp_objective_funciton</strong>:</p>
<ul class="simple">
<li><p><strong>Purpose</strong>: Serves as an objective function for optimization, comparing the simulation output to fit chamber ktp values.</p></li>
<li><p><strong>Inputs</strong>: Chamber ktp value, particle properties, time array, concentration, and radius bins.</p></li>
<li><p><strong>Outputs</strong>: Error metric from the simulation error function.</p></li>
</ul>
</li>
<li><p><strong>optimize_ktp_value</strong>:</p>
<ul class="simple">
<li><p><strong>Purpose</strong>: Optimizes the chamber ktp value to minimize the error between the simulated and observed particle distributions.</p></li>
<li><p><strong>Inputs</strong>: Initial guesses, bounds, and particle properties.</p></li>
<li><p><strong>Outputs</strong>: Optimized ktp value.</p></li>
</ul>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">simulate_chamber_interval</span><span class="p">(</span>
    <span class="n">particle_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">time_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">concentration_m3</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">radius_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate the aerosol chamber for a given time interval.</span>

<span class="sd">    This function simulates the dynamics of aerosol particles in a chamber</span>
<span class="sd">    over a specified time interval. It considers processes like</span>
<span class="sd">    coagulation, condensation, nucleation, dilution, and wall loss.</span>

<span class="sd">    Args:</span>
<span class="sd">    -----</span>
<span class="sd">        particle_kwargs (dict): Keyword arguments for the Particle object,</span>
<span class="sd">            including particle properties and chamber characteristics.</span>
<span class="sd">        time_array (np.ndarray): Array of time points over which to</span>
<span class="sd">            simulate the chamber dynamics.</span>
<span class="sd">        concentration_m3 (np.ndarray): Concentration of particles per</span>
<span class="sd">            cubic meter for each radius bin.</span>
<span class="sd">        radius_bins (np.ndarray): Array of radius bins for the particles.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">        tuple: A tuple containing two elements:</span>
<span class="sd">            - simulation_pdf (np.ndarray): The particle number density</span>
<span class="sd">                distribution over time as a probability density function.</span>
<span class="sd">            - concentration_pdf (np.ndarray): The concentration distribution</span>
<span class="sd">                over time as a probability density function.</span>

<span class="sd">    Note:</span>
<span class="sd">        - The function modifies &#39;particle_kwargs&#39; to include</span>
<span class="sd">            particle number and radius.</span>
<span class="sd">        - It assumes that the time array is increasing sequence of time points.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Convert size distribution to PDF</span>
    <span class="n">concentration_pdf</span> <span class="o">=</span> <span class="n">distribution_convert_pdf_pms</span><span class="p">(</span>
        <span class="n">x_array</span><span class="o">=</span><span class="n">radius_bins</span><span class="p">,</span>
        <span class="n">distribution</span><span class="o">=</span><span class="n">concentration_m3</span><span class="p">,</span>
        <span class="n">to_pdf</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span> <span class="o">*</span> <span class="n">radius_bins</span>

    <span class="c1"># Set number and radius in particle_kwargs</span>
    <span class="n">particle_kwargs</span><span class="p">[</span><span class="s2">&quot;particle_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">concentration_pdf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">particle_kwargs</span><span class="p">[</span><span class="s2">&quot;particle_radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">radius_bins</span>
    <span class="n">particle_kwargs</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># volume of concentration in cubic meters</span>

    <span class="c1"># Rebase time to start from zero</span>
    <span class="n">rebased_time</span> <span class="o">=</span> <span class="n">time_array</span> <span class="o">-</span> <span class="n">time_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Create particle distribution</span>
    <span class="n">particle_dist</span> <span class="o">=</span> <span class="n">particle</span><span class="o">.</span><span class="n">Particle</span><span class="p">(</span><span class="o">**</span><span class="n">particle_kwargs</span><span class="p">)</span>

    <span class="c1"># Pack the distribution into the solver</span>
    <span class="n">rates_kwargs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;particle&quot;</span><span class="p">:</span> <span class="n">particle_dist</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Initialize and solve the dynamics</span>
    <span class="n">solution_coag</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span>
        <span class="n">time_span</span><span class="o">=</span><span class="n">rebased_time</span><span class="p">,</span>
        <span class="n">do_coagulation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">do_condensation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">do_nucleation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">do_dilution</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">do_wall_loss</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">rates_kwargs</span>
    <span class="p">)</span><span class="o">.</span><span class="n">solution</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;odeint&#39;</span><span class="p">)</span>

    <span class="c1"># Process the solution</span>
    <span class="n">simulation_pdf</span> <span class="o">=</span> <span class="n">solution_coag</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">particle_dist</span><span class="o">.</span><span class="n">particle_radius</span>
    <span class="n">concentration_pdf</span> <span class="o">=</span> <span class="n">concentration_pdf</span> <span class="o">*</span> <span class="n">simulation_pdf</span><span class="o">.</span><span class="n">u</span>
    <span class="k">return</span> <span class="n">simulation_pdf</span><span class="p">,</span> <span class="n">concentration_pdf</span>


<span class="c1"># calculate the error</span>
<span class="k">def</span> <span class="nf">simulation_error</span><span class="p">(</span><span class="n">simulation_pdf</span><span class="p">,</span> <span class="n">concentration_pdf</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Mean Absolute Error (MAE) between simulation PDF and concentration PDF.</span>

<span class="sd">    The function computes the MAE as the average of absolute differences between </span>
<span class="sd">    the two provided probability density functions (PDFs). This metric is useful </span>
<span class="sd">    for quantifying the accuracy of a simulation against observed data.</span>

<span class="sd">    Args:</span>
<span class="sd">        simulation_pdf (np.ndarray): The simulated particle number density distribution as a PDF.</span>
<span class="sd">        concentration_pdf (np.ndarray): The observed concentration distribution as a PDF.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The Mean Absolute Error between the two PDFs.</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the input arrays do not have the same shape.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">simulation_pdf</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">concentration_pdf</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The shapes of simulation_pdf and concentration_pdf must be the same.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">simulation_pdf</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="n">concentration_pdf</span><span class="o">.</span><span class="n">m</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">chamber_ktp_objective_funciton</span><span class="p">(</span>
        <span class="n">chamber_ktp_value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">particle_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">time_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">concentration_m3</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">radius_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;objective funciton to compare simualiton of chamber to fit ktp values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">particle_kwargs</span><span class="p">[</span><span class="s1">&#39;chamber_ktp_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chamber_ktp_value</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="o">**-</span><span class="mi">1</span>

    <span class="n">simulation_pdf</span><span class="p">,</span> <span class="n">concentration_pdf</span> <span class="o">=</span> <span class="n">simulate_chamber_interval</span><span class="p">(</span>
        <span class="n">particle_kwargs</span><span class="o">=</span><span class="n">particle_kwargs</span><span class="p">,</span>
        <span class="n">time_array</span><span class="o">=</span><span class="n">time_array</span><span class="p">,</span>
        <span class="n">concentration_m3</span><span class="o">=</span><span class="n">concentration_m3</span><span class="p">,</span>
        <span class="n">radius_bins</span><span class="o">=</span><span class="n">radius_bins</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">simulation_error</span><span class="p">(</span><span class="n">simulation_pdf</span><span class="p">,</span> <span class="n">concentration_pdf</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">optimize_ktp_value</span><span class="p">(</span>
        <span class="n">particle_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">time_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">concentration_m3</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">radius_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">guess_ktp_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">display_fitting</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; optimized for ktp value&quot;&quot;&quot;</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="n">Bounds</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">problem</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">chamber_ktp_objective_funciton</span><span class="p">(</span>
            <span class="n">chamber_ktp_value</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">particle_kwargs</span><span class="o">=</span><span class="n">particle_kwargs</span><span class="p">,</span>
            <span class="n">time_array</span><span class="o">=</span><span class="n">time_array</span><span class="p">,</span>
            <span class="n">concentration_m3</span><span class="o">=</span><span class="n">concentration_m3</span><span class="p">,</span>
            <span class="n">radius_bins</span><span class="o">=</span><span class="n">radius_bins</span><span class="p">),</span>
        <span class="s1">&#39;x0&#39;</span><span class="p">:</span> <span class="n">guess_ktp_value</span><span class="p">,</span>
        <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="n">bounds</span><span class="p">,</span>
        <span class="s1">&#39;tol&#39;</span><span class="p">:</span> <span class="mf">1e-4</span><span class="p">,</span>
        <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="n">display_fitting</span><span class="p">,</span> <span class="s1">&#39;maxiter&#39;</span> <span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">minimize</span><span class="p">(</span><span class="o">**</span><span class="n">problem</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="performing-chamber-simulation-and-optimization">
<h2>Performing Chamber Simulation and Optimization<a class="headerlink" href="#performing-chamber-simulation-and-optimization" title="Link to this heading">#</a></h2>
<p>In this step, we use the previously defined functions to perform the actual simulation and optimization of the chamber environment. The focus here is to fine-tune the parameters for the an accurate representation of aerosol particle behavior in the chamber.</p>
<section id="setting-input-parameters">
<h3>Setting Input Parameters:<a class="headerlink" href="#setting-input-parameters" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Define a range of indices to select a subset of data for the simulation.</p></li>
<li><p>Extract the corresponding concentration and time array data from the dataset.</p></li>
<li><p>Set initial particle properties and chamber conditions (like density, charge, dilution rate, and chamber dimensions).</p></li>
</ul>
</section>
<section id="optimizing-ktp-value">
<h3>Optimizing ktp Value:<a class="headerlink" href="#optimizing-ktp-value" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Utilize the <code class="docutils literal notranslate"><span class="pre">optimize_ktp_value</span></code> function to find the optimal ktp value that minimizes the error between the simulated and observed particle distributions.</p></li>
<li><p>Display the optimized ktp value.</p></li>
</ul>
</section>
<section id="running-final-simulation">
<h3>Running Final Simulation:<a class="headerlink" href="#running-final-simulation" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Update the particle parameters with the optimized ktp value.</p></li>
<li><p>Run the simulate_chamber_interval function with the updated parameters to simulate the chamber environment.</p></li>
<li><p>Retrieve the simulated particle number density distribution and concentration distribution.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># inputs</span>
<span class="n">index_span</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="n">concentration_m3</span><span class="o">=</span> <span class="n">stream_averaged_2d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">index_span</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">index_span</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>
<span class="n">time_array_simulation</span> <span class="o">=</span> <span class="n">stream_averaged_2d</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">index_span</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">index_span</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

<span class="n">particle_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;particle_density&quot;</span><span class="p">:</span> <span class="mf">1.8e3</span><span class="p">,</span>  <span class="c1"># Density of particles in kg/m^3</span>
    <span class="s2">&quot;particle_charge&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># Charge of particles in elementary charges</span>
    <span class="s2">&quot;dilution_rate_coefficient&quot;</span><span class="p">:</span> <span class="n">k_rate_chamber_hr</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">hour</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;wall_loss_approximation&quot;</span><span class="p">:</span> <span class="s2">&quot;rectangle&quot;</span><span class="p">,</span>  <span class="c1"># Method for approximating wall loss</span>
    <span class="c1"># Dimensions of the chamber in meters</span>
    <span class="s2">&quot;chamber_dimension&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.739</span><span class="p">,</span> <span class="mf">0.739</span><span class="p">,</span> <span class="mf">1.663</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">,</span>
    <span class="s2">&quot;chamber_ktp_value&quot;</span><span class="p">:</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Rate of wall eddy diffusivity</span>
<span class="p">}</span>

<span class="c1"># Optimization</span>
<span class="n">fit_return</span> <span class="o">=</span> <span class="n">optimize_ktp_value</span><span class="p">(</span>
    <span class="n">particle_kwargs</span><span class="o">=</span><span class="n">particle_kwargs</span><span class="p">,</span>
    <span class="n">time_array</span><span class="o">=</span><span class="n">time_array_simulation</span><span class="p">,</span>
    <span class="n">concentration_m3</span><span class="o">=</span><span class="n">concentration_m3</span><span class="p">,</span>
    <span class="n">radius_bins</span><span class="o">=</span><span class="n">radius_bins</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fit ktp value: </span><span class="si">{</span><span class="n">fit_return</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fit error: </span><span class="si">{</span><span class="n">fit_return</span><span class="o">.</span><span class="n">fun</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Final Simulation</span>
<span class="n">particle_kwargs</span><span class="p">[</span><span class="s1">&#39;chamber_ktp_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_return</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="o">**-</span><span class="mi">1</span>
<span class="n">simulation_pdf</span><span class="p">,</span> <span class="n">concentration_pdf</span> <span class="o">=</span> <span class="n">simulate_chamber_interval</span><span class="p">(</span>
    <span class="n">particle_kwargs</span><span class="o">=</span><span class="n">particle_kwargs</span><span class="p">,</span>
    <span class="n">time_array</span><span class="o">=</span><span class="n">time_array_simulation</span><span class="p">,</span>
    <span class="n">concentration_m3</span><span class="o">=</span><span class="n">concentration_m3</span><span class="p">,</span>
    <span class="n">radius_bins</span><span class="o">=</span><span class="n">radius_bins</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fit ktp value: 0.768888288188083
Fit error: 92.00172725493776
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="visualization-of-simulation-results">
<h2>Visualization of Simulation Results<a class="headerlink" href="#visualization-of-simulation-results" title="Link to this heading">#</a></h2>
<p>In this section, we plot the results of our simulation to visualize how the particle size distribution changes over time in the chamber. This comparison between the initial and final states of both the simulation and experimental data provides valuable insights into the accuracy and dynamics of our model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting the simulation results</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

<span class="c1"># Plotting simulation and experimental data</span>
<span class="c1"># Initial distribution</span>
<span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span>
    <span class="n">radius_bins</span><span class="p">,</span>
    <span class="p">(</span><span class="n">simulation_pdf</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]),</span>
    <span class="s1">&#39;-b&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Start Simulation&#39;</span><span class="p">)</span>
<span class="c1"># Final distribution</span>
<span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span>
    <span class="n">radius_bins</span><span class="p">,</span>
    <span class="p">(</span><span class="n">simulation_pdf</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]),</span>
    <span class="s1">&#39;-r&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;t=End Simulation&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span>
    <span class="n">radius_bins</span><span class="p">,</span>
    <span class="n">concentration_pdf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span>
    <span class="s1">&#39;--k&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Start Experiment&#39;</span><span class="p">)</span>  <span class="c1"># Initial measured</span>
<span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span>
    <span class="n">radius_bins</span><span class="p">,</span>
    <span class="n">concentration_pdf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span>
    <span class="s1">&#39;--g&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;t=End Experiment&#39;</span><span class="p">)</span>  <span class="c1"># Final measured</span>

<span class="c1"># Setting labels, title, and grid</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Radius (meter)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number (</span><span class="si">{</span><span class="n">simulation_pdf</span><span class="o">.</span><span class="n">u</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Particle Size Distribution Over Time&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Adjust layout and show plot</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/matplotlib/cbook.py:1345: UnitStrippedWarning: The unit of the quantity is stripped when downcasting to ndarray.
  return np.asarray(x, float)
</pre></div>
</div>
<img alt="../../_images/e0ca12fa3a745d4b968ba0328656443bd72d03cf698667eefe7da4e5e35f7d27.png" src="../../_images/e0ca12fa3a745d4b968ba0328656443bd72d03cf698667eefe7da4e5e35f7d27.png" />
</div>
</div>
</section>
<section id="summary-of-the-notebook">
<h2>Summary of the Notebook<a class="headerlink" href="#summary-of-the-notebook" title="Link to this heading">#</a></h2>
<p>This Jupyter Notebook presents first approach to simulating and analyzing the behavior of aerosol particles in a chamber environment.</p>
<section id="achievements">
<h3>Achievements:<a class="headerlink" href="#achievements" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Successfully combined particle simulations with data import tools to optimize the wall-loss parameters in a chamber.</p></li>
<li><p>Refined the dataset for analysis through careful selection and cropping of time windows.</p></li>
<li><p>Utilized simulation functions to accurately represent and optimize the conditions within the aerosol chamber.</p></li>
<li><p>Visualized both processed and simulated data, providing clear insights into the particle behavior and the accuracy of the simulation.</p></li>
</ul>
</section>
<section id="next-steps">
<h3>Next Steps:<a class="headerlink" href="#next-steps" title="Link to this heading">#</a></h3>
<p>As a continuation of this research, the next step is to explore another method for solving the ordinary differential equation (ODE) problem. This will involve differentiating the data and fitting the aerosol rates more directly. This exploration aims to compare the effectiveness and efficiency of different approaches in modeling the dynamics of aerosol particles in a chamber environment.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "uncscode/particula",
            ref: "v0.0.10",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./examples/wall_loss"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="wall_loss_forward_simulation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chamber Forward Simulation</p>
      </div>
    </a>
    <a class="right-next"
       href="../lagrangian/lagrangian_intro.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lagrangian Particle Model</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#approach">Approach:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation-loading-and-converting-smps-data">Data Preparation: Loading and Converting SMPS Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation-time-window-selection-and-data-cleaning">Data Preparation: Time Window Selection and Data Cleaning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-of-processed-data">Visualization of Processed Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-simulation-properties-chamber-flow-rates-and-dilution-correction">Setting Simulation Properties: Chamber Flow Rates and Dilution Correction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-simulation-functions">Defining Simulation Functions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">Functions:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#performing-chamber-simulation-and-optimization">Performing Chamber Simulation and Optimization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-input-parameters">Setting Input Parameters:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optimizing-ktp-value">Optimizing ktp Value:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-final-simulation">Running Final Simulation:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-of-simulation-results">Visualization of Simulation Results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-the-notebook">Summary of the Notebook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#achievements">Achievements:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps:</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By particula contributors
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>