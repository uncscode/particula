
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Realistic Drag, Mass, and Velocity &#8212; Particula Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/lagrangian/turbulence_drops';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/placeholder.png" class="logo__image only-light" alt="Particula Book - Home"/>
    <script>document.write(`<img src="../../_static/placeholder.png" class="logo__image only-dark" alt="Particula Book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Getting started
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Tour</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../tour/part-tour.html">Particula tour</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../distribution_statistics.html">Distribution statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distribution_coagulation.html">Distribution coagulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distribution_evolution.html">Distribution evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distribution_ambient.html">Distributions</a></li>

<li class="toctree-l1"><a class="reference internal" href="../ionparticle_coagulation.html">Ion–particle coagulation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../streamlake/particula_data.html">Data in Particula</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../streamlake/loading_data_part1.html">Loading Part 1: Into &amp; 1D Data</a></li>



<li class="toctree-l2"><a class="reference internal" href="../streamlake/loading_data_part2.html">Loading Part 2: Sizer Data</a></li>

<li class="toctree-l2"><a class="reference internal" href="../streamlake/loading_data_part3.html">Loading Part 3: Lake</a></li>



<li class="toctree-l2"><a class="reference internal" href="../streamlake/loading_data_part4.html">Loading Part 4: Settings Files</a></li>

<li class="toctree-l2"><a class="reference internal" href="../streamlake/stream_stats_part1.html">Stream: Averaging and Outliers</a></li>



<li class="toctree-l2"><a class="reference internal" href="../streamlake/stream_stats_size_distribution_part2.html">Size Distribution Stats</a></li>



</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../wall_loss_section.html">Chamber Wall Loss Analysis</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../wall_loss/chamber_smps_data.html">Chamber Analysis</a></li>

<li class="toctree-l2"><a class="reference internal" href="../wall_loss/wall_loss_forward_simulation.html">Chamber Forward Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wall_loss/forward_fit_simple.html">Simple Wall Loss Fit</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="lagrangian_intro.html">Lagrangian Particle Model</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="basic_lagrangian_box.html">Introduction to the Lagrangian Box Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="sweep_and_prune.html">Sweep and Prune Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="friction_force.html">Realistic Drag, Mass, and Velocity</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../equilibria/equilibria_intro.html">Equilibria of Aerosols</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../equilibria/activity_part1.html">Activity Example</a></li>

<li class="toctree-l2"><a class="reference internal" href="../equilibria/equilibria_part1.html">Liquid Vapor Equilibrium</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../light_scattering/aerosol_optics_intro.html">Introduction to Aerosol Optics</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../light_scattering/mie_basics.html">Mie Scattering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../light_scattering/humid_scattering.html">Scattering for Humidified Particles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../light_scattering/kappa_vs_extinction.html">Fitting Kappa-HGF from Light Extinction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../light_scattering/scattering_truncation.html">Scattering Truncation Corrections</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../documentation/environment.html">The <code class="docutils literal notranslate"><span class="pre">Environment</span></code> Class</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/dilution_loss.html"><code class="docutils literal notranslate"><span class="pre">dilution_loss</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/dynamic_viscosity.html"><code class="docutils literal notranslate"><span class="pre">dynamic_viscosity</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/mean_free_path.html"><code class="docutils literal notranslate"><span class="pre">mean_free_path</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/vapor.html">The <code class="docutils literal notranslate"><span class="pre">Vapor</span></code> Class</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../documentation/particle.html">The <code class="docutils literal notranslate"><span class="pre">Particle</span></code> Classes</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/distribution_discretization.html"><code class="docutils literal notranslate"><span class="pre">distribution_discretization</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/radius_cutoff.html"><code class="docutils literal notranslate"><span class="pre">radius_cutoff</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/particle_mass.html"><code class="docutils literal notranslate"><span class="pre">particle_mass</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/knudsen_number.html"><code class="docutils literal notranslate"><span class="pre">knudsen_number</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/slip_correction.html"><code class="docutils literal notranslate"><span class="pre">slip_correction</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/friction_factor.html"><code class="docutils literal notranslate"><span class="pre">friction_factor</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/dimensionless_coagulation.html"><code class="docutils literal notranslate"><span class="pre">dimensionless_coagulation</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../documentation/utilities/utilities_overview.html">Utilities Functions</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/utilities/convert_size_dist_scales.html">Converting Distributions</a></li>


</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Strategic Plan</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../strategic_plan/strategic_planning_FY24.html">FY24 Plan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../strategic_plan/Aerosol_patterns.html">Program Outline Revision Draft</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Prototype</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../documentation/base/base_overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/base/gas.html">Gases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/base/base_particle.html">Strategies in Particle Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/base/base_aerosol.html">Aerosol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/base/base_runnable_process.html">Modeling Aerosol Dynamics with Runnable Processes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../CONTRIBUTING.html">Contributor Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CODE_OF_CONDUCT.html">Code of Conduct</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/uncscode/particula/v0.0.10?urlpath=lab/tree/docs/examples/lagrangian/turbulence_drops.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/uncscode/particula/blob/v0.0.10/docs/examples/lagrangian/turbulence_drops.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/uncscode/particula" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/uncscode/particula/edit/v0.0.10/docs/examples/lagrangian/turbulence_drops.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/uncscode/particula/issues/new?title=Issue%20on%20page%20%2Fexamples/lagrangian/turbulence_drops.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/examples/lagrangian/turbulence_drops.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Realistic Drag, Mass, and Velocity</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initialization-of-particles">Initialization of Particles</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-initial-conditions">Plotting Initial Conditions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#particle-size-distribution">Particle Size Distribution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#particle-velocity-distribution">Particle Velocity Distribution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-particle-simulation">Running the Particle Simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-particle-positions">Plotting Particle Positions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#size-distribution-of-particles">Size Distribution of Particles</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="realistic-drag-mass-and-velocity">
<h1>Realistic Drag, Mass, and Velocity<a class="headerlink" href="#realistic-drag-mass-and-velocity" title="Link to this heading">#</a></h1>
<p>This notebook section focuses on simulating cloud droplet-sized aerosol particles (around 100 microns) with accurate mass and velocity. Key improvements include:</p>
<ol class="arabic simple">
<li><p><strong>Refining Initial Conditions</strong>: Setting precise starting values for particle mass and velocity.</p></li>
<li><p><strong>Modeling Forces Accurately</strong>: Better representation of forces acting on particles to influence their movement.</p></li>
</ol>
<p>These steps are crucial for enhancing the realism of the aerosol particle model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Code Section: Importing Necessary Libraries and Initializing Variables</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">particula.lagrangian</span> <span class="kn">import</span> <span class="n">boundary</span><span class="p">,</span> <span class="n">integration</span><span class="p">,</span> <span class="n">collisions</span><span class="p">,</span> <span class="n">particle_property</span><span class="p">,</span> <span class="n">particle_pairs</span>
<span class="kn">from</span> <span class="nn">particula.util</span> <span class="kn">import</span> <span class="n">machine_limit</span>

<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span><span class="p">)</span> <span class="c1"># or &#39;cuda:0&#39; to specify a particular GPU</span>
<span class="n">torch</span><span class="o">.</span><span class="n">set_default_device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>


<span class="c1"># Initializing the Torch Generator and setting the data type</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">1234</span>
<span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>  <span class="c1"># Set the seed for reproducibility</span>
<span class="n">t_type</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">float32</span>

<span class="c1"># print particula version</span>
<span class="kn">from</span> <span class="nn">particula</span> <span class="kn">import</span> <span class="n">__version__</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;particula version: &quot;</span><span class="p">,</span> <span class="n">__version__</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>particula version:  0.0.16
</pre></div>
</div>
</div>
</div>
<section id="initialization-of-particles">
<h2>Initialization of Particles<a class="headerlink" href="#initialization-of-particles" title="Link to this heading">#</a></h2>
<p>In this section, we’ll enhance particle initialization for realism:</p>
<ul class="simple">
<li><p><strong>Particle Masses</strong>: Implementing a narrow log-normal distribution to better represent real-world mass variation.</p></li>
<li><p><strong>Particle Velocities</strong>: Utilizing thermal velocity, influenced by Brownian motion, for initial velocity settings.</p></li>
<li><p><strong>Initial Positions</strong>: Particles will be randomly placed within a defined box area to simulate natural distribution.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setting up the Simulation Parameters and Initial Conditions</span>

<span class="c1"># Define fixed parameters</span>
<span class="n">TOTAL_NUMBER_OF_PARTICLES</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">TIME_STEP</span> <span class="o">=</span> <span class="mf">0.005</span>
<span class="n">SIMULATION_TIME</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">CUBE_SIDE</span> <span class="o">=</span> <span class="mf">0.010</span>  <span class="c1"># Size of the simulation cube in meters</span>
<span class="n">save_points</span> <span class="o">=</span> <span class="mi">120</span>  <span class="c1"># Number of points to save the simulation data</span>
<span class="n">tke_sigma</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># Standard deviation of turbulent kinetic energy, m^2/s^2</span>

<span class="c1"># Defining new parameters for more realistic simulation</span>
<span class="n">density_uniform</span> <span class="o">=</span> <span class="mf">1.5e3</span>  <span class="c1"># Uniform density of particles in kg/m^3</span>
<span class="n">mean_radius_nm</span> <span class="o">=</span> <span class="mi">25000</span>  <span class="c1"># Mean radius of particles in nanometers</span>
<span class="n">std_dev_nm</span> <span class="o">=</span> <span class="mf">1.1</span>  <span class="c1"># Standard deviation of particle radius in nanometers</span>
<span class="n">system_temperature_kelvin</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># System temperature in Kelvin</span>
<span class="n">system_pressure_pascal</span> <span class="o">=</span> <span class="mf">1e5</span>  <span class="c1"># System pressure in Pascal</span>

<span class="c1"># Define intervals for updating interaction factors</span>
<span class="n">interval_friction_factor</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># Interval for updating friction factor</span>
<span class="n">interval_coagulation</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># Interval for updating coagulation</span>
<span class="n">regnerate_interval</span> <span class="o">=</span> <span class="mi">10000</span>  <span class="c1"># Interval for regenerating particles</span>
<span class="n">tke_interval</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># Interval for updating turbulent kinetic energy</span>

<span class="c1"># Generating particle masses using a log-normal distribution</span>
<span class="n">mass</span> <span class="o">=</span> <span class="n">particle_property</span><span class="o">.</span><span class="n">generate_particle_masses</span><span class="p">(</span>
    <span class="n">mean_radius</span><span class="o">=</span><span class="n">mean_radius_nm</span><span class="p">,</span>
    <span class="n">std_dev_radius</span><span class="o">=</span><span class="n">std_dev_nm</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="n">density_uniform</span><span class="p">,</span>
    <span class="n">num_particles</span><span class="o">=</span><span class="n">TOTAL_NUMBER_OF_PARTICLES</span><span class="p">,</span>
    <span class="n">radius_input_units</span><span class="o">=</span><span class="s2">&quot;nm&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Initializing particle velocities using thermal velocity</span>
<span class="n">velocity</span> <span class="o">=</span> <span class="n">particle_property</span><span class="o">.</span><span class="n">random_thermal_velocity</span><span class="p">(</span>
    <span class="n">temperature_kelvin</span><span class="o">=</span><span class="n">system_temperature_kelvin</span><span class="p">,</span>
    <span class="n">mass_kg</span><span class="o">=</span><span class="n">mass</span><span class="p">,</span>
    <span class="n">number_of_particles</span><span class="o">=</span><span class="n">TOTAL_NUMBER_OF_PARTICLES</span><span class="p">,</span>
    <span class="n">t_type</span><span class="o">=</span><span class="n">t_type</span><span class="p">,</span>
    <span class="n">random_seed</span><span class="o">=</span><span class="n">seed</span>
<span class="p">)</span>

<span class="c1"># Setting constant density for all particles</span>
<span class="n">density</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">TOTAL_NUMBER_OF_PARTICLES</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">t_type</span><span class="p">)</span> <span class="o">*</span> <span class="n">density_uniform</span>

<span class="c1"># Initialize particle positions randomly within the cube</span>
<span class="n">position</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span>
    <span class="mi">3</span><span class="p">,</span>
    <span class="n">TOTAL_NUMBER_OF_PARTICLES</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">t_type</span><span class="p">)</span> <span class="o">*</span> <span class="n">CUBE_SIDE</span> <span class="o">-</span> <span class="n">CUBE_SIDE</span> <span class="o">/</span> <span class="mi">2</span>

<span class="c1"># Initialize force as zero for all particles</span>
<span class="n">force</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">TOTAL_NUMBER_OF_PARTICLES</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">t_type</span><span class="p">)</span>

<span class="c1"># Generating indices for particles</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">TOTAL_NUMBER_OF_PARTICLES</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">t_type</span><span class="p">)</span>  <span class="c1"># Integer type</span>

<span class="c1"># Calculating the total number of iterations for the simulation</span>
<span class="n">total_iterations</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">SIMULATION_TIME</span> <span class="o">/</span> <span class="n">TIME_STEP</span><span class="p">)</span>

<span class="c1"># Initializing tensor to track total mass over iterations</span>
<span class="n">total_mass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">total_iterations</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">t_type</span><span class="p">)</span>

<span class="c1"># Defining gravity acting on all particles</span>
<span class="n">gravity</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">])</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">TOTAL_NUMBER_OF_PARTICLES</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Initializing Arrays for Saving Position and Mass Data</span>
<span class="n">save_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">TOTAL_NUMBER_OF_PARTICLES</span><span class="p">,</span> <span class="n">save_points</span><span class="p">))</span>
<span class="n">save_mass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">TOTAL_NUMBER_OF_PARTICLES</span><span class="p">,</span> <span class="n">save_points</span><span class="p">))</span>
<span class="n">save_iterations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_iterations</span><span class="p">,</span> <span class="n">save_points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Calculating particle radius from mass and density</span>
<span class="n">radius</span> <span class="o">=</span> <span class="n">particle_property</span><span class="o">.</span><span class="n">radius_calculation</span><span class="p">(</span><span class="n">mass</span><span class="o">=</span><span class="n">mass</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">RuntimeError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">25</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="n">tke_interval</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># Interval for updating turbulent kinetic energy</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="c1"># Generating particle masses using a log-normal distribution</span>
<span class="ne">---&gt; </span><span class="mi">25</span> <span class="n">mass</span> <span class="o">=</span> <span class="n">particle_property</span><span class="o">.</span><span class="n">generate_particle_masses</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span>     <span class="n">mean_radius</span><span class="o">=</span><span class="n">mean_radius_nm</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span>     <span class="n">std_dev_radius</span><span class="o">=</span><span class="n">std_dev_nm</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span>     <span class="n">density</span><span class="o">=</span><span class="n">density_uniform</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span>     <span class="n">num_particles</span><span class="o">=</span><span class="n">TOTAL_NUMBER_OF_PARTICLES</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span>     <span class="n">radius_input_units</span><span class="o">=</span><span class="s2">&quot;nm&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="c1"># Initializing particle velocities using thermal velocity</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span> <span class="n">velocity</span> <span class="o">=</span> <span class="n">particle_property</span><span class="o">.</span><span class="n">random_thermal_velocity</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span>     <span class="n">temperature_kelvin</span><span class="o">=</span><span class="n">system_temperature_kelvin</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">36</span>     <span class="n">mass_kg</span><span class="o">=</span><span class="n">mass</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span>     <span class="n">random_seed</span><span class="o">=</span><span class="n">seed</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span> <span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.8/x64/lib/python3.11/site-packages/particula/lagrangian/particle_property.py:164,</span> in <span class="ni">generate_particle_masses</span><span class="nt">(mean_radius, std_dev_radius, density, num_particles, radius_input_units)</span>
<span class="g g-Whitespace">    </span><span class="mi">159</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">160</span>         <span class="s2">&quot;log of Mean radius and standard deviation must be positive for&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">161</span>         <span class="o">+</span> <span class="s2">&quot; torch.distributions.log_normal.LogNormal&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">163</span> <span class="c1"># Sample radii from the log-normal distribution</span>
<span class="ne">--&gt; </span><span class="mi">164</span> <span class="n">radius_samples</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">log_normal</span><span class="o">.</span><span class="n">LogNormal</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">165</span>     <span class="n">mean_log</span><span class="p">,</span> <span class="n">std_dev_log</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">((</span><span class="n">num_particles</span><span class="p">,))</span>
<span class="g g-Whitespace">    </span><span class="mi">166</span> <span class="n">radius_samples</span> <span class="o">*=</span> <span class="n">torch</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">167</span>     <span class="n">convert_units</span><span class="p">(</span><span class="n">radius_input_units</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">169</span> <span class="c1"># Calculate mass of each particle</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.8/x64/lib/python3.11/site-packages/torch/distributions/log_normal.py:33,</span> in <span class="ni">LogNormal.__init__</span><span class="nt">(self, loc, scale, validate_args)</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span> <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">validate_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">33</span>     <span class="n">base_dist</span> <span class="o">=</span> <span class="n">Normal</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">validate_args</span><span class="o">=</span><span class="n">validate_args</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span>     <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">base_dist</span><span class="p">,</span> <span class="n">ExpTransform</span><span class="p">(),</span> <span class="n">validate_args</span><span class="o">=</span><span class="n">validate_args</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.8/x64/lib/python3.11/site-packages/torch/distributions/normal.py:51,</span> in <span class="ni">Normal.__init__</span><span class="nt">(self, loc, scale, validate_args)</span>
<span class="g g-Whitespace">     </span><span class="mi">50</span> <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">validate_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">51</span>     <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">broadcast_all</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">Number</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span>         <span class="n">batch_shape</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">()</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.8/x64/lib/python3.11/site-packages/torch/distributions/utils.py:49,</span> in <span class="ni">broadcast_all</span><span class="nt">(*values)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span>             <span class="n">options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span>             <span class="k">break</span>
<span class="ne">---&gt; </span><span class="mi">49</span>     <span class="n">new_values</span> <span class="o">=</span> <span class="p">[</span>
<span class="g g-Whitespace">     </span><span class="mi">50</span>         <span class="n">v</span> <span class="k">if</span> <span class="n">is_tensor_like</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">else</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span>
<span class="g g-Whitespace">     </span><span class="mi">51</span>     <span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>     <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">broadcast_tensors</span><span class="p">(</span><span class="o">*</span><span class="n">new_values</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span> <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">broadcast_tensors</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.8/x64/lib/python3.11/site-packages/torch/distributions/utils.py:50,</span> in <span class="ni">&lt;listcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span>             <span class="n">options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span>             <span class="k">break</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span>     <span class="n">new_values</span> <span class="o">=</span> <span class="p">[</span>
<span class="ne">---&gt; </span><span class="mi">50</span>         <span class="n">v</span> <span class="k">if</span> <span class="n">is_tensor_like</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">else</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span>
<span class="g g-Whitespace">     </span><span class="mi">51</span>     <span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>     <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">broadcast_tensors</span><span class="p">(</span><span class="o">*</span><span class="n">new_values</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span> <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">broadcast_tensors</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.8/x64/lib/python3.11/site-packages/torch/utils/_device.py:77,</span> in <span class="ni">DeviceContext.__torch_function__</span><span class="nt">(self, func, types, args, kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">75</span> <span class="k">if</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">_device_constructors</span><span class="p">()</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;device&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">76</span>     <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;device&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span>
<span class="ne">---&gt; </span><span class="mi">77</span> <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.8/x64/lib/python3.11/site-packages/torch/cuda/__init__.py:302,</span> in <span class="ni">_lazy_init</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">300</span> <span class="k">if</span> <span class="s2">&quot;CUDA_MODULE_LOADING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">301</span>     <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CUDA_MODULE_LOADING&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LAZY&quot;</span>
<span class="ne">--&gt; </span><span class="mi">302</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_cuda_init</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">303</span> <span class="c1"># Some of the queued calls may reentrantly call _lazy_init();</span>
<span class="g g-Whitespace">    </span><span class="mi">304</span> <span class="c1"># we need to just return without initializing in that case.</span>
<span class="g g-Whitespace">    </span><span class="mi">305</span> <span class="c1"># However, we must not let any *other* threads in!</span>
<span class="g g-Whitespace">    </span><span class="mi">306</span> <span class="n">_tls</span><span class="o">.</span><span class="n">is_initializing</span> <span class="o">=</span> <span class="kc">True</span>

<span class="ne">RuntimeError</span>: Found no NVIDIA driver on your system. Please check that you have an NVIDIA GPU and installed a driver from http://www.nvidia.com/Download/index.aspx
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># random air velcoity TKE generation</span>
<span class="n">air_velocity_length</span> <span class="o">=</span> <span class="n">total_iterations</span><span class="o">//</span><span class="n">tke_interval</span>
<span class="n">normal_dist</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">normal</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tke_sigma</span><span class="p">)</span>
<span class="n">air_velocities</span> <span class="o">=</span> <span class="n">normal_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">air_velocity_length</span><span class="p">))</span>

<span class="c1"># Calculating the initial turbulent kinetic energy</span>
<span class="k">def</span> <span class="nf">tke_calculation</span><span class="p">(</span><span class="n">air_velocities</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the turbulent kinetic energy from air velocity&quot;&quot;&quot;</span>
    <span class="n">std_velocities</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">air_velocities</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">tke</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">std_velocities</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tke</span>

<span class="n">tke</span> <span class="o">=</span> <span class="n">tke_calculation</span><span class="p">(</span><span class="n">air_velocities</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initial TKE: &quot;</span><span class="p">,</span> <span class="n">tke</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;velocity shape: &quot;</span><span class="p">,</span> <span class="n">air_velocities</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Air initial velocity: &quot;</span><span class="p">,</span> <span class="n">air_velocities</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial TKE:  tensor(0.3742)
velocity shape:  torch.Size([3, 86400])
Air initial velocity:  tensor([ 0.3003, -0.4218, -0.4296])
</pre></div>
</div>
</div>
</div>
</section>
<section id="plotting-initial-conditions">
<h2>Plotting Initial Conditions<a class="headerlink" href="#plotting-initial-conditions" title="Link to this heading">#</a></h2>
<p>To verify the realism of our particle model, we’ll plot the initial distributions of particle size and velocity. This step ensures that the initial setup aligns with our expectations and the intended simulation parameters.</p>
<section id="particle-size-distribution">
<h3>Particle Size Distribution<a class="headerlink" href="#particle-size-distribution" title="Link to this heading">#</a></h3>
<p>First, we examine the distribution of particle radii. The goal is to confirm that the radii follow the specified log-normal distribution.</p>
</section>
<section id="particle-velocity-distribution">
<h3>Particle Velocity Distribution<a class="headerlink" href="#particle-velocity-distribution" title="Link to this heading">#</a></h3>
<p>Next, we assess the distribution of particle velocities. This is crucial for ensuring that the initial velocities reflect thermal motion as intended.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting the Initial Radius Distribution</span>

<span class="c1"># Calculate the initial radius of particles</span>
<span class="n">radius_initial</span> <span class="o">=</span> <span class="n">particle_property</span><span class="o">.</span><span class="n">radius_calculation</span><span class="p">(</span>
    <span class="n">mass</span><span class="o">=</span><span class="n">mass</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">)</span>

<span class="c1"># Plotting the histogram for radius distribution</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">machine_limit</span><span class="o">.</span><span class="n">safe_log10</span><span class="p">(</span><span class="n">radius_initial</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;log10 Radius (m)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of Particles&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Initial Particle Radius Distribution&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Plotting the Initial Velocity Distribution</span>

<span class="c1"># Calculate the speeds of particles from their velocities</span>
<span class="n">initial_speeds</span> <span class="o">=</span> <span class="n">particle_property</span><span class="o">.</span><span class="n">speed</span><span class="p">(</span><span class="n">velocity</span><span class="p">)</span>

<span class="c1"># Plotting the histogram for velocity distribution</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">machine_limit</span><span class="o">.</span><span class="n">safe_log10</span><span class="p">(</span><span class="n">initial_speeds</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;log10 Velocity (m/s)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of Particles&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Initial Particle Velocity Distribution&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/eaff4beeca67247754016b41c85aa928f1fefab1447c6b9f2e032541969ea3c1.png" src="../../_images/eaff4beeca67247754016b41c85aa928f1fefab1447c6b9f2e032541969ea3c1.png" />
<img alt="../../_images/6a59ea2f044131540467b11553bf50e6129986c0ceedfbc4262f6c659f229418.png" src="../../_images/6a59ea2f044131540467b11553bf50e6129986c0ceedfbc4262f6c659f229418.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Printing the Maximum and Minimum Radii of the Particles</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initial Max Diameter [mm]: &quot;</span><span class="p">,</span> <span class="n">radius_initial</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Initial Min Diameter [mm]: &quot;</span><span class="p">,</span>
    <span class="n">radius_initial</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">*</span>
    <span class="mi">2</span> <span class="o">*</span>
    <span class="mf">1e3</span><span class="p">)</span>

<span class="c1"># Initializing the Range of Radii for Friction Factor Calculation</span>
<span class="c1"># We use a linspace to cover a range from the smallest to 10 times the</span>
<span class="c1"># largest radius.</span>
<span class="n">friction_factor_radius</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
    <span class="n">start</span><span class="o">=</span><span class="n">radius</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
    <span class="n">end</span><span class="o">=</span><span class="n">radius</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Calculating the Friction Factor</span>
<span class="c1"># This calculation considers the radius, temperature, and pressure to</span>
<span class="c1"># determine the friction factor.</span>
<span class="n">friction_factor_array</span> <span class="o">=</span> <span class="n">particle_property</span><span class="o">.</span><span class="n">friction_factor_wrapper</span><span class="p">(</span>
    <span class="n">radius_meter</span><span class="o">=</span><span class="n">friction_factor_radius</span><span class="p">,</span>
    <span class="n">temperature_kelvin</span><span class="o">=</span><span class="n">system_temperature_kelvin</span><span class="p">,</span>
    <span class="n">pressure_pascal</span><span class="o">=</span><span class="n">system_pressure_pascal</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Plotting Friction Factor vs Radius</span>
<span class="c1"># The plot helps in visualizing how friction factor varies with particle</span>
<span class="c1"># radius.</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">friction_factor_radius</span><span class="p">,</span> <span class="n">friction_factor_array</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Radius (m)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Friction Factor&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial Max Diameter [mm]:  0.06673528696410358
Initial Min Diameter [mm]:  0.03808399196714163
</pre></div>
</div>
<img alt="../../_images/175149232624dc19ef5c1bed5e7b1e2dde5c05738175a84701486f4498d6ba40.png" src="../../_images/175149232624dc19ef5c1bed5e7b1e2dde5c05738175a84701486f4498d6ba40.png" />
</div>
</div>
</section>
</section>
<section id="running-the-particle-simulation">
<h2>Running the Particle Simulation<a class="headerlink" href="#running-the-particle-simulation" title="Link to this heading">#</a></h2>
<p>In this part of the notebook, we execute the core simulation loop. This involves integrating the motion of the particles over time while considering the forces acting on them, including friction and gravity. Several key updates and optimizations are included:</p>
<ol class="arabic simple">
<li><p><strong>Friction Factor Initialization</strong>: Before entering the main loop, the friction factor for each particle is calculated. This is an essential step for accurately simulating the drag force on particles.</p></li>
<li><p><strong>Conditional Coagulation Step</strong>: The simulation includes an optional coagulation step, executed at a specified interval. This step simulates the merging of particles upon collision, affecting their mass and velocity.</p></li>
<li><p><strong>Friction Factor Update</strong>: The friction factor is updated at regular intervals to reflect changes in particle size or other environmental conditions. This step ensures that the drag force remains accurate throughout the simulation.</p></li>
<li><p><strong>Force Calculation and Integration</strong>: Within each iteration, we calculate the forces acting on the particles and update their positions and velocities using the leapfrog integration method.</p></li>
<li><p><strong>Boundary Conditions and Data Saving</strong>: The simulation includes boundary conditions to mimic a wrapped cube environment. Additionally, particle position and mass data are saved at predefined intervals for analysis.</p></li>
</ol>
<p>This simulation loop provides a comprehensive and dynamic model of particle motion, taking into account physical factors and interactions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize Counter for Saving Data and Start Timer</span>
<span class="n">save_counter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># Initial Calculations Before Starting the Simulation Loop</span>
<span class="n">radius</span> <span class="o">=</span> <span class="n">particle_property</span><span class="o">.</span><span class="n">radius_calculation</span><span class="p">(</span><span class="n">mass</span><span class="o">=</span><span class="n">mass</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">)</span>
<span class="n">friction_factor_iter</span> <span class="o">=</span> <span class="n">particle_property</span><span class="o">.</span><span class="n">nearest_match</span><span class="p">(</span>
    <span class="n">x_values</span><span class="o">=</span><span class="n">friction_factor_radius</span><span class="p">,</span>
    <span class="n">y_values</span><span class="o">=</span><span class="n">friction_factor_array</span><span class="p">,</span>
    <span class="n">x_new</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># regeneration of radius and velocity</span>
<span class="n">regen_radius</span> <span class="o">=</span> <span class="n">radius</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">regen_velocity</span> <span class="o">=</span> <span class="n">velocity</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">regen_mass</span> <span class="o">=</span> <span class="n">mass</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">air_ones</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">TOTAL_NUMBER_OF_PARTICLES</span><span class="p">))</span>
<span class="n">air_velocity</span> <span class="o">=</span> <span class="n">air_ones</span><span class="o">*</span><span class="n">air_velocities</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Main Simulation Loop</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_iterations</span><span class="p">):</span>

    <span class="c1"># Coagulation Step (Optional, based on specified interval)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">interval_coagulation</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Update radius for collision detection</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">particle_property</span><span class="o">.</span><span class="n">radius_calculation</span><span class="p">(</span>
            <span class="n">mass</span><span class="o">=</span><span class="n">mass</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">)</span>
        <span class="c1"># Detect potential collision pairs</span>
        <span class="n">valid_collision_indices_pairs</span> <span class="o">=</span> <span class="n">particle_pairs</span><span class="o">.</span><span class="n">full_sweep_and_prune</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">)</span>

        <span class="c1"># Process collisions and update particle properties</span>
        <span class="k">if</span> <span class="n">valid_collision_indices_pairs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">velocity</span><span class="p">,</span> <span class="n">mass</span> <span class="o">=</span> <span class="n">collisions</span><span class="o">.</span><span class="n">coalescence</span><span class="p">(</span>
                <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
                <span class="n">velocity</span><span class="o">=</span><span class="n">velocity</span><span class="p">,</span>
                <span class="n">mass</span><span class="o">=</span><span class="n">mass</span><span class="p">,</span>
                <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
                <span class="n">collision_indices_pairs</span><span class="o">=</span><span class="n">valid_collision_indices_pairs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">regnerate_interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># regenerate for constant particle number</span>
        <span class="n">zero_mass_bool</span> <span class="o">=</span> <span class="n">mass</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">radius</span><span class="p">[</span><span class="n">zero_mass_bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">regen_radius</span><span class="p">[</span><span class="n">zero_mass_bool</span><span class="p">]</span>
        <span class="n">velocity</span><span class="p">[:,</span> <span class="n">zero_mass_bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">regen_velocity</span><span class="p">[:,</span> <span class="n">zero_mass_bool</span><span class="p">]</span>
        <span class="n">mass</span><span class="p">[</span><span class="n">zero_mass_bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">regen_mass</span><span class="p">[</span><span class="n">zero_mass_bool</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">tke_interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># regenerate air velocity</span>
        <span class="n">air_velocity</span> <span class="o">=</span> <span class="n">air_ones</span><span class="o">*</span><span class="n">air_velocities</span><span class="p">[:,</span> <span class="n">i</span><span class="o">//</span><span class="n">tke_interval</span><span class="p">]</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Update Friction Factor (Optional, based on specified interval)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">interval_friction_factor</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">particle_property</span><span class="o">.</span><span class="n">radius_calculation</span><span class="p">(</span>
            <span class="n">mass</span><span class="o">=</span><span class="n">mass</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">)</span>
        <span class="n">friction_factor_iter</span> <span class="o">=</span> <span class="n">particle_property</span><span class="o">.</span><span class="n">nearest_match</span><span class="p">(</span>
            <span class="n">x_values</span><span class="o">=</span><span class="n">friction_factor_radius</span><span class="p">,</span>
            <span class="n">y_values</span><span class="o">=</span><span class="n">friction_factor_array</span><span class="p">,</span>
            <span class="n">x_new</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Calculate Forces (including updated friction factor)</span>
    <span class="n">force</span> <span class="o">=</span> <span class="n">mass</span> <span class="o">*</span> <span class="n">gravity</span> <span class="o">+</span> <span class="p">(</span><span class="n">air_velocity</span> <span class="o">-</span> <span class="n">velocity</span><span class="p">)</span> <span class="o">*</span> <span class="n">friction_factor_iter</span>

    <span class="c1"># Integrate Equations of Motion (Leapfrog Method)</span>
    <span class="n">position</span><span class="p">,</span> <span class="n">velocity</span> <span class="o">=</span> <span class="n">integration</span><span class="o">.</span><span class="n">leapfrog</span><span class="p">(</span>
        <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">velocity</span><span class="o">=</span><span class="n">velocity</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="n">mass</span><span class="p">,</span> <span class="n">time_step</span><span class="o">=</span><span class="n">TIME_STEP</span><span class="p">)</span>

    <span class="c1"># Apply Boundary Conditions (Cube Wrap-around)</span>
    <span class="n">position</span> <span class="o">=</span> <span class="n">boundary</span><span class="o">.</span><span class="n">wrapped_cube</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">cube_side</span><span class="o">=</span><span class="n">CUBE_SIDE</span><span class="p">)</span>

    <span class="c1"># Save Data at Predefined Intervals</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">save_iterations</span><span class="p">[</span><span class="n">save_counter</span><span class="p">]:</span>
        <span class="n">save_position</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">save_counter</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">save_mass</span><span class="p">[:,</span> <span class="n">save_counter</span><span class="p">]</span> <span class="o">=</span> <span class="n">mass</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">save_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving data at iteration </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">total_iterations</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Final Data Save and Calculation of Total Simulation Time</span>
<span class="n">save_position</span><span class="p">[:,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<span class="n">save_mass</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mass</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total wall time: </span><span class="si">{</span><span class="n">end_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Ratio of wall time to simulation time: </span><span class="si">{</span><span class="p">(</span><span class="n">end_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">SIMULATION_TIME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Saving data at iteration 0 of 8640000
Saving data at iteration 72605 of 8640000
Saving data at iteration 145210 of 8640000
Saving data at iteration 217815 of 8640000
Saving data at iteration 290420 of 8640000
Saving data at iteration 363025 of 8640000
Saving data at iteration 435630 of 8640000
Saving data at iteration 508235 of 8640000
Saving data at iteration 580840 of 8640000
Saving data at iteration 653445 of 8640000
Saving data at iteration 726050 of 8640000
Saving data at iteration 798655 of 8640000
Saving data at iteration 871260 of 8640000
Saving data at iteration 943865 of 8640000
Saving data at iteration 1016470 of 8640000
Saving data at iteration 1089075 of 8640000
Saving data at iteration 1161680 of 8640000
Saving data at iteration 1234285 of 8640000
Saving data at iteration 1306890 of 8640000
Saving data at iteration 1379495 of 8640000
Saving data at iteration 1452100 of 8640000
Saving data at iteration 1524705 of 8640000
Saving data at iteration 1597310 of 8640000
Saving data at iteration 1669915 of 8640000
Saving data at iteration 1742521 of 8640000
Saving data at iteration 1815126 of 8640000
Saving data at iteration 1887731 of 8640000
Saving data at iteration 1960336 of 8640000
Saving data at iteration 2032941 of 8640000
Saving data at iteration 2105546 of 8640000
Saving data at iteration 2178151 of 8640000
Saving data at iteration 2250756 of 8640000
Saving data at iteration 2323361 of 8640000
Saving data at iteration 2395966 of 8640000
Saving data at iteration 2468571 of 8640000
Saving data at iteration 2541176 of 8640000
Saving data at iteration 2613781 of 8640000
Saving data at iteration 2686386 of 8640000
Saving data at iteration 2758991 of 8640000
Saving data at iteration 2831596 of 8640000
Saving data at iteration 2904201 of 8640000
Saving data at iteration 2976806 of 8640000
Saving data at iteration 3049411 of 8640000
Saving data at iteration 3122016 of 8640000
Saving data at iteration 3194621 of 8640000
Saving data at iteration 3267226 of 8640000
Saving data at iteration 3339831 of 8640000
Saving data at iteration 3412436 of 8640000
Saving data at iteration 3485042 of 8640000
Saving data at iteration 3557647 of 8640000
Saving data at iteration 3630252 of 8640000
Saving data at iteration 3702857 of 8640000
Saving data at iteration 3775462 of 8640000
Saving data at iteration 3848067 of 8640000
Saving data at iteration 3920672 of 8640000
Saving data at iteration 3993277 of 8640000
Saving data at iteration 4065882 of 8640000
Saving data at iteration 4138487 of 8640000
Saving data at iteration 4211092 of 8640000
Saving data at iteration 4283697 of 8640000
Saving data at iteration 4356302 of 8640000
Saving data at iteration 4428907 of 8640000
Saving data at iteration 4501512 of 8640000
Saving data at iteration 4574117 of 8640000
Saving data at iteration 4646722 of 8640000
Saving data at iteration 4719327 of 8640000
Saving data at iteration 4791932 of 8640000
Saving data at iteration 4864537 of 8640000
Saving data at iteration 4937142 of 8640000
Saving data at iteration 5009747 of 8640000
Saving data at iteration 5082352 of 8640000
Saving data at iteration 5154957 of 8640000
Saving data at iteration 5227563 of 8640000
Saving data at iteration 5300168 of 8640000
Saving data at iteration 5372773 of 8640000
Saving data at iteration 5445378 of 8640000
Saving data at iteration 5517983 of 8640000
Saving data at iteration 5590588 of 8640000
Saving data at iteration 5663193 of 8640000
Saving data at iteration 5735798 of 8640000
Saving data at iteration 5808403 of 8640000
Saving data at iteration 5881008 of 8640000
Saving data at iteration 5953613 of 8640000
Saving data at iteration 6026218 of 8640000
Saving data at iteration 6098823 of 8640000
Saving data at iteration 6171428 of 8640000
Saving data at iteration 6244033 of 8640000
Saving data at iteration 6316638 of 8640000
Saving data at iteration 6389243 of 8640000
Saving data at iteration 6461848 of 8640000
Saving data at iteration 6534453 of 8640000
Saving data at iteration 6607058 of 8640000
Saving data at iteration 6679663 of 8640000
Saving data at iteration 6752268 of 8640000
Saving data at iteration 6824873 of 8640000
Saving data at iteration 6897478 of 8640000
Saving data at iteration 6970084 of 8640000
Saving data at iteration 7042689 of 8640000
Saving data at iteration 7115294 of 8640000
Saving data at iteration 7187899 of 8640000
Saving data at iteration 7260504 of 8640000
Saving data at iteration 7333109 of 8640000
Saving data at iteration 7405714 of 8640000
Saving data at iteration 7478319 of 8640000
Saving data at iteration 7550924 of 8640000
Saving data at iteration 7623529 of 8640000
Saving data at iteration 7696134 of 8640000
Saving data at iteration 7768739 of 8640000
Saving data at iteration 7841344 of 8640000
Saving data at iteration 7913949 of 8640000
Saving data at iteration 7986554 of 8640000
Saving data at iteration 8059159 of 8640000
Saving data at iteration 8131764 of 8640000
Saving data at iteration 8204369 of 8640000
Saving data at iteration 8276974 of 8640000
Saving data at iteration 8349579 of 8640000
Saving data at iteration 8422184 of 8640000
Saving data at iteration 8494789 of 8640000
Saving data at iteration 8567394 of 8640000
Total wall time: 3740.235196828842 seconds
Ratio of wall time to simulation time: 0.08657951844511208
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># save data</span>
<span class="n">np</span><span class="o">.</span><span class="n">savez_compressed</span><span class="p">(</span>
    <span class="s2">&quot;data_tke.npz&quot;</span><span class="p">,</span>
    <span class="n">position</span><span class="o">=</span><span class="n">save_position</span><span class="p">,</span>
    <span class="n">mass</span><span class="o">=</span><span class="n">save_mass</span><span class="p">,</span>
    <span class="n">iterations</span><span class="o">=</span><span class="n">save_iterations</span><span class="p">,</span>
    <span class="n">time_step</span><span class="o">=</span><span class="n">TIME_STEP</span><span class="p">,</span>
    <span class="n">total_iterations</span><span class="o">=</span><span class="n">total_iterations</span><span class="p">,</span>
    <span class="n">total_number_of_particles</span><span class="o">=</span><span class="n">TOTAL_NUMBER_OF_PARTICLES</span><span class="p">,</span>
    <span class="n">simulation_time</span><span class="o">=</span><span class="n">SIMULATION_TIME</span><span class="p">,</span>
    <span class="n">cube_side</span><span class="o">=</span><span class="n">CUBE_SIDE</span><span class="p">,</span>
    <span class="n">density_uniform</span><span class="o">=</span><span class="n">density_uniform</span><span class="p">,</span>
    <span class="n">mean_radius_nm</span><span class="o">=</span><span class="n">mean_radius_nm</span><span class="p">,</span>
    <span class="n">std_dev_nm</span><span class="o">=</span><span class="n">std_dev_nm</span><span class="p">,</span>
    <span class="n">system_temperature_kelvin</span><span class="o">=</span><span class="n">system_temperature_kelvin</span><span class="p">,</span>
    <span class="n">system_pressure_pascal</span><span class="o">=</span><span class="n">system_pressure_pascal</span><span class="p">,</span>
    <span class="n">interval_friction_factor</span><span class="o">=</span><span class="n">interval_friction_factor</span><span class="p">,</span>
    <span class="n">interval_coagulation</span><span class="o">=</span><span class="n">interval_coagulation</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
    <span class="n">friction_factor_radius</span><span class="o">=</span><span class="n">friction_factor_radius</span><span class="p">,</span>
    <span class="n">friction_factor_array</span><span class="o">=</span><span class="n">friction_factor_array</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plotting-particle-positions">
<h2>Plotting Particle Positions<a class="headerlink" href="#plotting-particle-positions" title="Link to this heading">#</a></h2>
<p>After running the simulation, we’ll plot the particle positions to visualize their movement.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Processing the Final Data for Visualization</span>

<span class="c1"># Select the final time index for the data</span>
<span class="n">time_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">position_final</span> <span class="o">=</span> <span class="n">save_position</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">time_index</span><span class="p">]</span>
<span class="n">mass_final</span> <span class="o">=</span> <span class="n">save_mass</span><span class="p">[:,</span> <span class="n">time_index</span><span class="p">]</span>

<span class="c1"># Filter out particles with zero mass</span>
<span class="n">filter_zero_mass</span> <span class="o">=</span> <span class="n">mass_final</span> <span class="o">&gt;</span> <span class="mi">0</span>

<span class="c1"># Calculate the radius and area of each particle</span>
<span class="n">radius_final</span> <span class="o">=</span> <span class="n">particle_property</span><span class="o">.</span><span class="n">radius_calculation</span><span class="p">(</span><span class="n">mass</span><span class="o">=</span><span class="n">mass_final</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">)</span>
<span class="n">particle_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">radius_final</span><span class="o">**</span><span class="mi">2</span>
<span class="c1"># normalize the area</span>
<span class="n">particle_area</span> <span class="o">=</span> <span class="n">particle_area</span> <span class="o">/</span> <span class="n">particle_area</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>


<span class="c1"># Display the number of remaining particles</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of particles at the end: </span><span class="si">{</span><span class="n">filter_zero_mass</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Creating a 3D Plot for Visualization</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

<span class="c1"># Choose a color map for the scatter plot</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span>

<span class="c1"># Plot the final positions of particles with non-zero mass</span>
<span class="n">scatter_plot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">position_final</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">filter_zero_mass</span><span class="p">],</span>
    <span class="n">position_final</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">filter_zero_mass</span><span class="p">],</span>
    <span class="n">position_final</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">filter_zero_mass</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="n">mass_final</span><span class="p">[</span><span class="n">filter_zero_mass</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="n">particle_area</span><span class="p">[</span><span class="n">filter_zero_mass</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span> <span class="c1"># scalled Particle size based on normalized area</span>
<span class="p">)</span>

<span class="c1"># # Set axis limits based on cube dimensions</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">CUBE_SIDE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">CUBE_SIDE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">CUBE_SIDE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">CUBE_SIDE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="o">-</span><span class="n">CUBE_SIDE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">CUBE_SIDE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Add a color bar indicating particle mass</span>
<span class="n">color_bar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scatter_plot</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">color_bar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Mass [kg]&#39;</span><span class="p">)</span>

<span class="c1"># Show the plot with optimized layout</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of particles at the end: 500
</pre></div>
</div>
<img alt="../../_images/2375038662c124f4df67882d76e75da3db7f7b9450cbec02f21d96e95d34b800.png" src="../../_images/2375038662c124f4df67882d76e75da3db7f7b9450cbec02f21d96e95d34b800.png" />
</div>
</div>
</section>
<section id="size-distribution-of-particles">
<h2>Size Distribution of Particles<a class="headerlink" href="#size-distribution-of-particles" title="Link to this heading">#</a></h2>
<p>Given particle collision and coagulation, we’ll plot the distribution of particle sizes at the end of the simulation. This step ensures that the particle size distribution aligns with our expectations and the intended simulation parameters. That being, both a decrease in the number of particles and an increase in the average particle size.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualizing the Mass Distribution at Different Stages</span>

<span class="c1"># plot initial radius distribution</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">machine_limit</span><span class="o">.</span><span class="n">safe_log10</span><span class="p">(</span><span class="n">radius_initial</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Initial&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">machine_limit</span><span class="o">.</span><span class="n">safe_log10</span><span class="p">(</span><span class="n">radius_final</span><span class="p">[</span><span class="n">filter_zero_mass</span><span class="p">]),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Final&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;log10 Radius (m)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of Particles&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Initial Particle Radius Distribution&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initial Max Diameter [mm]: &quot;</span><span class="p">,</span> <span class="n">radius_initial</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final Max Diameter [mm]: &quot;</span><span class="p">,</span> <span class="n">radius_final</span><span class="p">[</span><span class="n">filter_zero_mass</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0df3a83990fdda1dff908937a541312131583bbd2e95f6dd0e71e4ea79d483fa.png" src="../../_images/0df3a83990fdda1dff908937a541312131583bbd2e95f6dd0e71e4ea79d483fa.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial Max Diameter [mm]:  0.06673528696410358
Final Max Diameter [mm]:  0.3941673396242591
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "uncscode/particula",
            ref: "v0.0.10",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./examples/lagrangian"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initialization-of-particles">Initialization of Particles</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-initial-conditions">Plotting Initial Conditions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#particle-size-distribution">Particle Size Distribution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#particle-velocity-distribution">Particle Velocity Distribution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-particle-simulation">Running the Particle Simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-particle-positions">Plotting Particle Positions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#size-distribution-of-particles">Size Distribution of Particles</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By particula contributors
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>